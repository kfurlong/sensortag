<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>module ti.uia.runtime.LogSnapshot</title>
<meta name="googlebot" content="noindex,nofollow">
<link rel="stylesheet" type="text/css" href="../../../src.css"/>
</head>
<body>
<pre class=src>
     1    <span class="comment">/*
</span>     2    <span class="comment"> * Copyright (c) 2012-2013, Texas Instruments Incorporated
</span>     3    <span class="comment"> * All rights reserved.
</span>     4    <span class="comment"> *
</span>     5    <span class="comment"> * Redistribution and use in source and binary forms, with or without
</span>     6    <span class="comment"> * modification, are permitted provided that the following conditions
</span>     7    <span class="comment"> * are met:
</span>     8    <span class="comment"> *
</span>     9    <span class="comment"> * *  Redistributions of source code must retain the above copyright
</span>    10    <span class="comment"> *    notice, this list of conditions and the following disclaimer.
</span>    11    <span class="comment"> *
</span>    12    <span class="comment"> * *  Redistributions in binary form must reproduce the above copyright
</span>    13    <span class="comment"> *    notice, this list of conditions and the following disclaimer in the
</span>    14    <span class="comment"> *    documentation and/or other materials provided with the distribution.
</span>    15    <span class="comment"> *
</span>    16    <span class="comment"> * *  Neither the name of Texas Instruments Incorporated nor the names of
</span>    17    <span class="comment"> *    its contributors may be used to endorse or promote products derived
</span>    18    <span class="comment"> *    from this software without specific prior written permission.
</span>    19    <span class="comment"> *
</span>    20    <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
</span>    21    <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
</span>    22    <span class="comment"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
</span>    23    <span class="comment"> * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
</span>    24    <span class="comment"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
</span>    25    <span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
</span>    26    <span class="comment"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
</span>    27    <span class="comment"> * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
</span>    28    <span class="comment"> * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
</span>    29    <span class="comment"> * OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
</span>    30    <span class="comment"> * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span>    31    <span class="comment"> * */</span>
    32    
    33    <span class="comment">/*
</span>    34    <span class="comment"> *  ======== LogSnapshot.xdc ========
</span>    35    <span class="comment"> */</span>
    36    <span class=key>package</span> ti.uia.runtime;
    37    import xdc.runtime.Types;
    38    import ti.uia.runtime.LoggerTypes;
    39    import xdc.runtime.ILogger;
    40    import ti.uia.runtime.CtxFilter;
    41    import xdc.runtime.ILogger;
    42    import xdc.runtime.Diags;
    43    import xdc.runtime.Text;
    44    import ti.uia.events.UIASnapshot;
    45    import ti.uia.runtime.IUIATraceSyncClient;
    46    
    47    <span class="xdoc">/*!
</span>    48    <span class="xdoc"> *  ======== LogSnapshot ========
</span>    49    <span class="xdoc"> *  Snapshot Event logging manager for logging blocks of memory, strings in memory
</span>    50    <span class="xdoc"> *     and names of dynamically created objects
</span>    51    <span class="xdoc"> *
</span>    52    <span class="xdoc"> *  {<b>@link</b> ti.uia.events.UIASnapshot Snapshot events} are used to log dynamic
</span>    53    <span class="xdoc"> *  target state information in order to
</span>    54    <span class="xdoc"> *  capture the execution context of the application at a particular moment in
</span>    55    <span class="xdoc"> *  time.  Types of information that can be logged include:
</span>    56    <span class="xdoc"> *  <b>@p(blist)</b>
</span>    57    <span class="xdoc"> *      - Blocks of memory (using the {<b>@link</b> #writeMemoryBlock LogSnapshot_writeMemoryBlock} API)
</span>    58    <span class="xdoc"> *      - Strings that reside in memory (using the {<b>@link</b> #writeString LogSnapshot_writeString} API)
</span>    59    <span class="xdoc"> *      - Names of dynamically created objects (using the {<b>@link</b> #writeNameOfReference LogSnapshot_writeNameOfReference} API)
</span>    60    <span class="xdoc"> *  <b>@p</b>
</span>    61    <span class="xdoc"> *  The host-side tooling can be instructed to treat a series of LogSnapshot
</span>    62    <span class="xdoc"> *  events as representing the state of the target at the same moment in time by
</span>    63    <span class="xdoc"> *  using the same non-zero value in the {<b>@link</b> #getSnapshotId snapshot ID} parameter
</span>    64    <span class="xdoc"> *  of each of the LogSnapshot events in the series.
</span>    65    <span class="xdoc"> *
</span>    66    <span class="xdoc"> *  Snapshot events are logged by a logger that implements the
</span>    67    <span class="xdoc"> *  {<b>@link</b> ti.uia.runtime.ILoggerSnapshot ILoggerSnapshot}
</span>    68    <span class="xdoc"> *  interface (e.g. {<b>@link</b> ti.uia.runtime.LoggerCircBuf LoggerCircBuf},
</span>    69    <span class="xdoc"> *  {<b>@link</b> ti.uia.runtime.LoggerStopMode LoggerStopMode},
</span>    70    <span class="xdoc"> *  {<b>@link</b> ti.uia.runtime.LoggerProbePoint LoggerProbePoint}).
</span>    71    <span class="xdoc"> *  Rather than invoking the logger's APIs directly, the APIs are
</span>    72    <span class="xdoc"> *  called indirectly via the LogSnapshot module's APIs so that different types
</span>    73    <span class="xdoc"> *  of loggers can be used without having to recompile the source code that is
</span>    74    <span class="xdoc"> *  logging the snapshot events.
</span>    75    <span class="xdoc"> * <b>@a(Examples)</b>
</span>    76    <span class="xdoc"> *  <b>@p(html)</b>
</span>    77    <span class="xdoc"> *  &lt;B&gt;Example 1: A simple 2-line configuration script&lt;/B&gt;
</span>    78    <span class="xdoc"> *  <b>@p</b>
</span>    79    <span class="xdoc"> *  The following configuration script shows the simplest way
</span>    80    <span class="xdoc"> * to configure an application to use log snapshot events:
</span>    81    <span class="xdoc"> * <b>@p(code)</b>
</span>    82    <span class="xdoc"> * var LoggingSetup = xdc.useModule('ti.uia.sysbios.LoggingSetup');
</span>    83    <span class="xdoc"> * var LogSnapshot   = xdc.useModule('ti.uia.runtime.LogSnapshot');
</span>    84    <span class="xdoc"> * <b>@p</b>
</span>    85    <span class="xdoc"> * The first line causes the {<b>@link</b> ti.uia.sysbios.LoggingSetup LoggingSetup}
</span>    86    <span class="xdoc"> * module's .xs script to automatically create a 32K Byte logger and assign it to
</span>    87    <span class="xdoc"> * xdc.runtime.Main.common$.logger.  It also sets any unconfigured Diags masks
</span>    88    <span class="xdoc"> * for the Main module to Diags.RUNTIME_ON, enabling the events to be logged.
</span>    89    <span class="xdoc"> * <b>@p</b>
</span>    90    <span class="xdoc"> * The second line causes the LogSnapshot .xs script to run during the configuration
</span>    91    <span class="xdoc"> * process when building the application. The script detects that a logger has
</span>    92    <span class="xdoc"> * not been assigned to the LogSnapshot module, so it checks if
</span>    93    <span class="xdoc"> * a logger has been configured for either the Main module or the Defaults module.
</span>    94    <span class="xdoc"> * Since there is a logger for the Main module, the script configures the LogSnapshot
</span>    95    <span class="xdoc"> * module to log events to the same logger instance.
</span>    96    <span class="xdoc"> *
</span>    97    <span class="xdoc"> *  <b>@p(html)</b>
</span>    98    <span class="xdoc"> *  &lt;hr /&gt;
</span>    99    <span class="xdoc"> *  &lt;B&gt;Example 2: Using a dedicated low priority logger for snapshot events&lt;/B&gt;
</span>   100    <span class="xdoc"> *  <b>@p</b>
</span>   101    <span class="xdoc"> * In some situations, the amount of data logged by the LogSnapshot
</span>   102    <span class="xdoc"> * APIs may exceed the ability of the target to move the event data out of the
</span>   103    <span class="xdoc"> * Main module's logger's circular buffer and up to the host.  One way of
</span>   104    <span class="xdoc"> * ensuring that the other events that are logged are not dropped due to this
</span>   105    <span class="xdoc"> * type of situation is to configure the LogSnapshot module to write events
</span>   106    <span class="xdoc"> * to a separate lower priority logger.
</span>   107    <span class="xdoc"> * <b>@p</b>
</span>   108    <span class="xdoc"> * The following is an example of a
</span>   109    <span class="xdoc"> * configuration script that configures a logger for use by the LogSnapshot
</span>   110    <span class="xdoc"> * module.  This example uses a LoggerCircBuf logger, which is appropriate for
</span>   111    <span class="xdoc"> * uploading events in real-time as the target executes using either
</span>   112    <span class="xdoc"> * JTAG RunMode(C6X targets) or using a non-JTAG transport such as Ethernet.
</span>   113    <span class="xdoc"> * Assigning this logger a {<b>@link</b> ti.uia.runtime.IUIATransferlow#Priority_LOW
</span>   114    <span class="xdoc"> * low priority} causes the contents of this logger to be uploaded after
</span>   115    <span class="xdoc"> * higher priority events (e.g. sync point events, context change events,
</span>   116    <span class="xdoc"> * and error, warning, info events) have been uploaded.
</span>   117    <span class="xdoc"> * <b>@p</b>
</span>   118    <span class="xdoc"> * <b>@p(code)</b>
</span>   119    <span class="xdoc"> * var Logger = xdc.useModule('ti.uia.runtime.LoggerCircBuf');
</span>   120    <span class="xdoc"> * var LogSnapshot   = xdc.useModule('ti.uia.runtime.LogSnapshot');
</span>   121    <span class="xdoc"> *
</span>   122    <span class="xdoc"> * // Create a low priority logger and use it for snapshot events
</span>   123    <span class="xdoc"> * var IUIATransfer = xdc.useModule('ti.uia.runtime.IUIATransfer');
</span>   124    <span class="xdoc"> * var loggerParams = new Logger.Params();
</span>   125    <span class="xdoc"> * loggerParams.priority = IUIATransfer.Priority_LOW;
</span>   126    <span class="xdoc"> * // set the logger buffer size in bytes
</span>   127    <span class="xdoc"> * loggerParams.transferBufSize = 32768;
</span>   128    <span class="xdoc"> * var snapshotLogger = Logger.create(loggerParams);
</span>   129    <span class="xdoc"> * snapshotLogger.instance.name = "SnapshotLog";
</span>   130    <span class="xdoc"> * LogSnapshot.common$.logger = snapshotLogger;
</span>   131    <span class="xdoc"> * <b>@p</b>
</span>   132    <span class="xdoc"> * Using different types of loggers:
</span>   133    <span class="xdoc"> * <b>@p(blist)</b>
</span>   134    <span class="xdoc"> *      - To upload events by JTAG when the target halts (JTAG StopMode),
</span>   135    <span class="xdoc"> * replace the first line in the example with
</span>   136    <span class="xdoc"> * <b>@p(code)</b>
</span>   137    <span class="xdoc"> * Logger = xdc.useModule('ti.uia.runtime.LoggerStopMode');
</span>   138    <span class="xdoc"> * <b>@p(blist)</b>
</span>   139    <span class="xdoc"> *      - To upload events by JTAG whenever an event is logged using probe point
</span>   140    <span class="xdoc"> * breakpoints (i.e. momentarily halting the target while the event is uploaded
</span>   141    <span class="xdoc"> * and then resuming execution), replace the first line in the example with
</span>   142    <span class="xdoc"> * <b>@p(code)</b>
</span>   143    <span class="xdoc"> * Logger = xdc.useModule('ti.uia.runtime.LoggerProbePoint');
</span>   144    <span class="xdoc"> * <b>@p</b>
</span>   145    <span class="xdoc"> *
</span>   146    <span class="xdoc"> *
</span>   147    <span class="xdoc"> *  <b>@p(html)</b>
</span>   148    <span class="xdoc"> *  &lt;hr /&gt;
</span>   149    <span class="xdoc"> *  &lt;B&gt;Example 3: Using Diags masks to control snapshot events&lt;/B&gt;
</span>   150    <span class="xdoc"> *  <b>@p</b>
</span>   151    <span class="xdoc"> *  The generation of a 'Snapshot' event is controlled by a module's diagnostics
</span>   152    <span class="xdoc"> *  mask, which is described in details in the CDoc for xdc.runtime.Diags. Each
</span>   153    <span class="xdoc"> *  {<b>@link</b> ti.uia.events.UIASnapshot snapshot event} is controlled using the
</span>   154    <span class="xdoc"> *  Diags.ANALYSIS mask, and will only be logged when the diagnostics mask for
</span>   155    <span class="xdoc"> *  the module that is logging the code has the Diags.ANALYSIS bit
</span>   156    <span class="xdoc"> *  configured as either ALWAYS_ON or RUNTIME_ON.
</span>   157    <span class="xdoc"> *  <b>@p</b>
</span>   158    <span class="xdoc"> *  The `LogSnapshot` function call sites are implemented in such a way that an
</span>   159    <span class="xdoc"> *  optimizer can completely eliminate `LogSnapshot` code from the program if
</span>   160    <span class="xdoc"> *  the module's `ANALYSIS` events have been disabled at configuration time. If
</span>   161    <span class="xdoc"> *  the 'ANALYSIS' events are permanently turned on at configuration time,
</span>   162    <span class="xdoc"> *  then the optimizer can eliminate all runtime conditional checking and
</span>   163    <span class="xdoc"> *  simply invoke the 'LogSnapshot' functions directly. Runtime checking is
</span>   164    <span class="xdoc"> *  performed only when the ANALYSIS events are configured to be runtime
</span>   165    <span class="xdoc"> *  modifiable.
</span>   166    <span class="xdoc"> *  <b>@p</b>
</span>   167    <span class="xdoc"> * The following is an example of the configuration script used
</span>   168    <span class="xdoc"> * to configure the default mask for modules to have Analysis events such as
</span>   169    <span class="xdoc"> * the UIASnapshot events always on.
</span>   170    <span class="xdoc"> * <b>@p(code)</b>
</span>   171    <span class="xdoc"> *  // Configure all modules to always log Analysis events
</span>   172    <span class="xdoc"> *  var Diags = xdc.useModule('xdc.runtime.Diags');
</span>   173    <span class="xdoc"> *  var Defaults = xdc.useModule('xdc.runtime.Defaults');
</span>   174    <span class="xdoc"> *  Defaults.common$.diags_ANALYSIS = Diags.ALWAYS_ON;
</span>   175    <span class="xdoc"> * <b>@p</b>
</span>   176    <span class="xdoc"> *
</span>   177    <span class="xdoc"> */</span>
   178    
   179    @CustomHeader
   180    <span class=key>module</span> LogSnapshot <span class=key>inherits</span> IUIATraceSyncClient {
   181    
   182        <span class="xdoc">/*!
</span>   183    <span class="xdoc">     *  ======== EventRec ========
</span>   184    <span class="xdoc">     *  The target representation of a recorded event
</span>   185    <span class="xdoc">     *
</span>   186    <span class="xdoc">     *  This structure defines how events are recorded on the target.
</span>   187    <span class="xdoc">     */</span>
   188        <span class=key>struct</span> EventRec {
   189            Types.Timestamp64 tstamp; <span class="xdoc">/*! time event was written */</span>
   190            Bits32 serial; <span class="xdoc">/*! serial number of event */</span>
   191            Types.Event evt; <span class="xdoc">/*! target encoding of an Event */</span>
   192            Int snapshotId;
   193            IArg fmt;
   194            Ptr pData;
   195            UInt16 lengthInMAUs; <span class="xdoc">/*! arguments passed via Log_write/print */</span>
   196        }
   197        <span class="xdoc">/*!
</span>   198    <span class="xdoc">     *  ======== maxLengthInMAUs ========
</span>   199    <span class="xdoc">     *  Maximum number of MAUs (miniumum addressable units, e.g. bytes)
</span>   200    <span class="xdoc">     *     supported by `LogSnapshot` events.
</span>   201    <span class="xdoc">     *
</span>   202    <span class="xdoc">     *  Attempting to write more than the maximum length results in the
</span>   203    <span class="xdoc">     *  multiple events being logged.  The maxLengthInMAUs must be
</span>   204    <span class="xdoc">     *  lower than the size of the buffer that the events are being logged to.
</span>   205    <span class="xdoc">     *  Must be less than 1400 in order to support streaming of event
</span>   206    <span class="xdoc">     *  data over UDP.
</span>   207    <span class="xdoc">     */</span>
   208        <span class=key>config</span> Int maxLengthInMAUs = 512;
   209    
   210        <span class="xdoc">/*!
</span>   211    <span class="xdoc">     *  ======== isTimestampEnabled ========
</span>   212    <span class="xdoc">     *  used to enable or disable logging the 64b local CPU timestamp
</span>   213    <span class="xdoc">     *  at the start of each event
</span>   214    <span class="xdoc">     */</span>
   215        <span class=key>config</span> Bool isTimestampEnabled = <span class=key>true</span>;
   216    
   217        <span class="xdoc">/*! <b>@_nodoc</b>
</span>   218    <span class="xdoc">     *  ======== loggerDefined ========
</span>   219    <span class="xdoc">     *  set to true in the configuration script when a logger that implements
</span>   220    <span class="xdoc">     *  ILoggerSnapshot is attached
</span>   221    <span class="xdoc">     */</span>
   222        <span class=key>config</span> Bool loggerDefined = <span class=key>false</span>;
   223        <span class="xdoc">/*!
</span>   224    <span class="xdoc">     *  ======== loggerObj ========
</span>   225    <span class="xdoc">     *  handle of the logger that is to be used to log snapshot events
</span>   226    <span class="xdoc">     */</span>
   227        <span class=key>config</span> Ptr loggerObj = <span class=key>null</span>;
   228    
   229        <span class="xdoc">/*! <b>@_nodoc</b> */</span>
   230        <span class=key>config</span> ti.uia.runtime.LoggerTypes.LogMemoryRangeFxn loggerMemoryRangeFxn = <span class=key>null</span>;
   231        <span class="comment">/*======================================================================*/</span>
   232    
   233        <span class="xdoc">/*!
</span>   234    <span class="xdoc">     *  ======== putMemoryRange ========
</span>   235    <span class="xdoc">     *  Unconditionally put the specified `Types` event.
</span>   236    <span class="xdoc">     *  Supports both writeMemoryRange and writeString.
</span>   237    <span class="xdoc">     *
</span>   238    <span class="xdoc">     *  This method unconditionally puts the specified memoryRange`{<b>@link</b> Types#Event}`
</span>   239    <span class="xdoc">     *  `evt` into the log.  This type of event is created either implicitly
</span>   240    <span class="xdoc">     *  (and passed to an `{<b>@link</b> ISnapshotLogger}` implementation) or explicitly
</span>   241    <span class="xdoc">     *  via `{<b>@link</b> Types#makeEvent()}`.
</span>   242    <span class="xdoc">     *
</span>   243    <span class="xdoc">     *  <b>@param(evt)</b>         the `Types` event to put into the log
</span>   244    <span class="xdoc">     *  <b>@param(mid)</b>         the module ID of the caller
</span>   245    <span class="xdoc">     *  <b>@param(snapshotId)</b>  unique ID that binds together a series of events used to
</span>   246    <span class="xdoc">     *                      log a large memory range.  Upper 16b hold the ID Tag (0 for UIA)
</span>   247    <span class="xdoc">     *  <b>@param(fileName)</b>    the name of the file that the event was logged from
</span>   248    <span class="xdoc">     *  <b>@param(lineNum)</b>     the line number that the event was logged from
</span>   249    <span class="xdoc">     *  <b>@param(fmt)</b>         a user-specified print format string
</span>   250    <span class="xdoc">     *  <b>@param(startAdrs)</b>   the start address of the memory range to log
</span>   251    <span class="xdoc">     *  <b>@param(lengthInMAUs)</b>   the number of minimum addressable units (e.g. bytes) to log
</span>   252    <span class="xdoc">     *  <b>@a(return)</b>          value to use as snapshotId parameter for subsequent events
</span>   253    <span class="xdoc">     */</span>
   254        @Macro Void putMemoryRange(Types.Event evt, Types.ModuleId mid,
   255          IArg fileName, IArg lineNum, UInt32 snapshotID, IArg fmt, IArg startAdrs, IArg lengthInMAUs);
   256    
   257        <span class="xdoc">/*!
</span>   258    <span class="xdoc">     *  ======== writeMemoryBlockWithIdTag ========
</span>   259    <span class="xdoc">     *  Generate a `LogSnapshot` event for a block of memory
</span>   260    <span class="xdoc">     *
</span>   261    <span class="xdoc">     * <b>@a(Examples)</b>
</span>   262    <span class="xdoc">     * Example: The following C code shows how to log a snapshot event to
</span>   263    <span class="xdoc">     *   capture a block of memory.
</span>   264    <span class="xdoc">     *
</span>   265    <span class="xdoc">     *  <b>@p(code)</b>
</span>   266    <span class="xdoc">     *  #include &lt;ti/uia/runtime/LogSnapshot.h&gt;
</span>   267    <span class="xdoc">     *  ...
</span>   268    <span class="xdoc">     *  UInt32* pIntArray = (UInt32 *)malloc(sizeof(UInt32) * 200);
</span>   269    <span class="xdoc">     *  ...
</span>   270    <span class="xdoc">     *  UInt16 myCustomIdTag = 1;
</span>   271    <span class="xdoc">     *  LogSnapshot_writeMemoryBlockWithIdTag(myCustomIdTag,0,"pIntArray ptr=0x%x, numBytes=%d",(UInt32)pIntArray,200);
</span>   272    <span class="xdoc">     *  ...
</span>   273    <span class="xdoc">     *  <b>@p</b>
</span>   274    <span class="xdoc">     *  The following text will be displayed for the event, if it was logged
</span>   275    <span class="xdoc">     *  from file demo.c at line 1234 and all 200 bytes were logged in the
</span>   276    <span class="xdoc">     *  same event.
</span>   277    <span class="xdoc">     *  <b>@p(code)</b>
</span>   278    <span class="xdoc">     *  Memory Snapshot at [demo.c:1234] [snapshotID=0,adrs=0x80002000,
</span>   279    <span class="xdoc">     *    numMAUsDataInEvent=200,numMAUsDataInRecord=200] ptr=0x80002000, numBytes=200
</span>   280    <span class="xdoc">     *  <b>@p</b>
</span>   281    <span class="xdoc">     *  If the 200 bytes were spread across multiple events,
</span>   282    <span class="xdoc">     *  the numMAUsDataInRecord would indicate how many bytes were in the
</span>   283    <span class="xdoc">     *  memory block, and numMAUsDataInEvent would indicate how many bytes
</span>   284    <span class="xdoc">     *  were stored in that particular event.
</span>   285    <span class="xdoc">     *  <b>@p</b>
</span>   286    <span class="xdoc">     *  <b>@param(idTag)</b>      ID used to identify who logged the event. Set to 0 for a
</span>   287    <span class="xdoc">     *                     standard UIA event.  Can be used to filter snapshot events on host.
</span>   288    <span class="xdoc">     *  <b>@param(snapshotID)</b> ID used to identify snapshot events taken at the same
</span>   289    <span class="xdoc">     *                     time. Set to 0 for first in series, set rest to return
</span>   290    <span class="xdoc">     *                     value of LogSnapshot API.  {<b>@link</b> #getSnapshotId see getSnapshotId()}
</span>   291    <span class="xdoc">     *  <b>@param(fmt)</b>        a constant string that provides a user-readable description
</span>   292    <span class="xdoc">     *                     of what information the event is capturing
</span>   293    <span class="xdoc">     *  <b>@param(pMemoryRange)</b>  the start address of the range of memory
</span>   294    <span class="xdoc">     *  <b>@param(lengthInMAUs)</b> the number of MAUs of data payload for the
</span>   295    <span class="xdoc">     *                     multi-event data record
</span>   296    <span class="xdoc">     */</span>
   297        @Macro Void writeMemoryBlockWithIdTag(UInt16 idTag, UInt32 snapshotID, IArg fmt, Ptr pMemoryRange,
   298          UInt16 lengthInMAUs);
   299    
   300        <span class="xdoc">/*!
</span>   301    <span class="xdoc">     *  ======== writeMemoryBlock ========
</span>   302    <span class="xdoc">     *  Generate a `LogSnapshot` event for a block of memory
</span>   303    <span class="xdoc">     *
</span>   304    <span class="xdoc">     * <b>@a(Examples)</b>
</span>   305    <span class="xdoc">     * Example: The following C code shows how to log a snapshot event to
</span>   306    <span class="xdoc">     *   capture a block of memory.
</span>   307    <span class="xdoc">     *
</span>   308    <span class="xdoc">     *  <b>@p(code)</b>
</span>   309    <span class="xdoc">     *  #include &lt;ti/uia/runtime/LogSnapshot.h&gt;
</span>   310    <span class="xdoc">     *  ...
</span>   311    <span class="xdoc">     *  UInt32* pIntArray = (UInt32 *)malloc(sizeof(UInt32) * 200);
</span>   312    <span class="xdoc">     *  ...
</span>   313    <span class="xdoc">     *  LogSnapshot_writeMemoryBlock(0,"pIntArray ptr=0x%x, numBytes=%d",(UInt32)pIntArray,200);
</span>   314    <span class="xdoc">     *  ...
</span>   315    <span class="xdoc">     *  <b>@p</b>
</span>   316    <span class="xdoc">     *  The following text will be displayed for the event, if it was logged
</span>   317    <span class="xdoc">     *  from file demo.c at line 1234 and all 200 bytes were logged in the
</span>   318    <span class="xdoc">     *  same event.
</span>   319    <span class="xdoc">     *  <b>@p(code)</b>
</span>   320    <span class="xdoc">     *  Memory Snapshot at [demo.c:1234] [snapshotID=0,adrs=0x80002000,
</span>   321    <span class="xdoc">     *    numMAUsDataInEvent=200,numMAUsDataInRecord=200] ptr=0x80002000, numBytes=200
</span>   322    <span class="xdoc">     *  <b>@p</b>
</span>   323    <span class="xdoc">     *  If the 200 bytes were spread across multiple events,
</span>   324    <span class="xdoc">     *  the numMAUsDataInRecord would indicate how many bytes were in the
</span>   325    <span class="xdoc">     *  memory block, and numMAUsDataInEvent would indicate how many bytes
</span>   326    <span class="xdoc">     *  were stored in that particular event.
</span>   327    <span class="xdoc">     *  <b>@p</b>
</span>   328    <span class="xdoc">     *  <b>@param(snapshotID)</b> ID used to identify snapshot events taken at the same
</span>   329    <span class="xdoc">     *                     time. Set to 0 for first in series, set rest to return
</span>   330    <span class="xdoc">     *                     value of LogSnapshot API.  {<b>@link</b> #getSnapshotId see getSnapshotId()}
</span>   331    <span class="xdoc">     *  <b>@param(fmt)</b>        a constant string that provides a user-readable description
</span>   332    <span class="xdoc">     *                     of what information the event is capturing
</span>   333    <span class="xdoc">     *  <b>@param(pMemoryRange)</b>  the start address of the range of memory
</span>   334    <span class="xdoc">     *  <b>@param(lengthInMAUs)</b> the number of MAUs of data payload for the
</span>   335    <span class="xdoc">     *                     multi-event data record
</span>   336    <span class="xdoc">     */</span>
   337        @Macro Void writeMemoryBlock(UInt32 snapshotID, IArg fmt, Ptr pMemoryRange,
   338          UInt16 lengthInMAUs);
   339    
   340        <span class="xdoc">/*!
</span>   341    <span class="xdoc">     *  ======== writeStringWithIdTag ========
</span>   342    <span class="xdoc">     *  Generate a `LogSnapshot` event for a string in memory
</span>   343    <span class="xdoc">     *
</span>   344    <span class="xdoc">     *  <b>@a(Example)</b>
</span>   345    <span class="xdoc">     *   The following C code shows how to log a snapshot event to log the
</span>   346    <span class="xdoc">     *   contents of a string in memory.
</span>   347    <span class="xdoc">     *
</span>   348    <span class="xdoc">     *  <b>@p(code)</b>
</span>   349    <span class="xdoc">     *  #include &lt;ti/uia/runtime/LogSnapshot.h&gt;
</span>   350    <span class="xdoc">     *  ...
</span>   351    <span class="xdoc">     *  Void myFunc(String name){
</span>   352    <span class="xdoc">     *     ...
</span>   353    <span class="xdoc">     *     UInt16 myCustomIdTag = 1;
</span>   354    <span class="xdoc">     *     LogSnapshot_writeStringWithIdTag(myCustomIdTag,0,"User-defined name=%s.",name, strlen(name));
</span>   355    <span class="xdoc">     *  }
</span>   356    <span class="xdoc">     *  <b>@p</b>
</span>   357    <span class="xdoc">     *  The following text will be displayed for the event, if it was logged
</span>   358    <span class="xdoc">     *  from file demo.c at line 1234 and all bytes in the 40 character string
</span>   359    <span class="xdoc">     *  was logged in the same event.
</span>   360    <span class="xdoc">     *  <b>@p(code)</b>
</span>   361    <span class="xdoc">     *  String Snapshot at [../demo.c:1234] [snapshotID=0,adrs=0x80001234,40,40] User-defined name=ValueOfParm.
</span>   362    <span class="xdoc">     *  <b>@p</b>
</span>   363    <span class="xdoc">     *  <b>@param(idTag)</b>      ID used to identify who logged the event. Set to 0 for a
</span>   364    <span class="xdoc">     *                     standard UIA event.  Can be used to filter snapshot events on host.
</span>   365    <span class="xdoc">     *  <b>@param(snapshotID)</b> ID used to identify snapshot events taken at the same
</span>   366    <span class="xdoc">     *                     time. Set to 0 for first in series, set rest to return
</span>   367    <span class="xdoc">     *                     value of LogSnapshot API. {<b>@link</b> #getSnapshotId see getSnapshotId()}
</span>   368    <span class="xdoc">     *  <b>@param(fmt)</b>        a constant string that provides a user-readable description
</span>   369    <span class="xdoc">     *                     of what information the event is capturing
</span>   370    <span class="xdoc">     *  <b>@param(pString)</b>    the start address of the string in memory
</span>   371    <span class="xdoc">     *  <b>@param(lengthInMAUs)</b> the number of MAUs to log (e.g. strlen(pString))
</span>   372    <span class="xdoc">     */</span>
   373        @Macro Void writeStringWithIdTag(UInt16 idTag, UInt32 snapshotID, IArg fmt, Ptr pString,
   374        UInt16 lengthInMAUs);
   375    
   376        <span class="xdoc">/*!
</span>   377    <span class="xdoc">     *  ======== writeString ========
</span>   378    <span class="xdoc">     *  Generate a `LogSnapshot` event for a string in memory
</span>   379    <span class="xdoc">     *
</span>   380    <span class="xdoc">     *  <b>@a(Example)</b>
</span>   381    <span class="xdoc">     *   The following C code shows how to log a snapshot event to log the
</span>   382    <span class="xdoc">     *   contents of a string in memory.
</span>   383    <span class="xdoc">     *
</span>   384    <span class="xdoc">     *  <b>@p(code)</b>
</span>   385    <span class="xdoc">     *  #include &lt;ti/uia/runtime/LogSnapshot.h&gt;
</span>   386    <span class="xdoc">     *  ...
</span>   387    <span class="xdoc">     *  Void myFunc(String name){
</span>   388    <span class="xdoc">     *     ...
</span>   389    <span class="xdoc">     *     LogSnapshot_writeString(0,"User-defined name=%s.",name, strlen(name));
</span>   390    <span class="xdoc">     *  }
</span>   391    <span class="xdoc">     *  <b>@p</b>
</span>   392    <span class="xdoc">     *  The following text will be displayed for the event, if it was logged
</span>   393    <span class="xdoc">     *  from file demo.c at line 1234 and all bytes in the 40 character string
</span>   394    <span class="xdoc">     *  was logged in the same event.
</span>   395    <span class="xdoc">     *  <b>@p(code)</b>
</span>   396    <span class="xdoc">     *  String Snapshot at [../demo.c:1234] [snapshotID=0,adrs=0x80001234,40,40] User-defined name=ValueOfParm.
</span>   397    <span class="xdoc">     *  <b>@p</b>
</span>   398    <span class="xdoc">     *  <b>@param(snapshotID)</b> ID used to identify snapshot events taken at the same
</span>   399    <span class="xdoc">     *                     time. Set to 0 for first in series, set rest to return
</span>   400    <span class="xdoc">     *                     value of LogSnapshot API. {<b>@link</b> #getSnapshotId see getSnapshotId()}
</span>   401    <span class="xdoc">     *  <b>@param(fmt)</b>        a constant string that provides a user-readable description
</span>   402    <span class="xdoc">     *                     of what information the event is capturing
</span>   403    <span class="xdoc">     *  <b>@param(pString)</b>    the start address of the string in memory
</span>   404    <span class="xdoc">     *  <b>@param(lengthInMAUs)</b> the number of MAUs to log (e.g. strlen(pString))
</span>   405    <span class="xdoc">     */</span>
   406        @Macro Void writeString(UInt32 snapshotID, IArg fmt, Ptr pString,
   407        UInt16 lengthInMAUs);
   408    
   409        <span class="xdoc">/*!
</span>   410    <span class="xdoc">     *  ======== nameOfReference ========
</span>   411    <span class="xdoc">     *  Used to log the contents of a dynamic string on the heap so that host-side
</span>   412    <span class="xdoc">     *  tooling can display this string as the name of handle / reference ID
</span>   413    <span class="xdoc">     *
</span>   414    <span class="xdoc">     *  <b>@a(Example)</b>
</span>   415    <span class="xdoc">     *   The following C code shows how to log a task name for use by task
</span>   416    <span class="xdoc">     *   execution graphs etc.
</span>   417    <span class="xdoc">     *
</span>   418    <span class="xdoc">     *  <b>@p(code)</b>
</span>   419    <span class="xdoc">     *  #include &lt;ti/uia/runtime/LogSnapshot.h&gt;
</span>   420    <span class="xdoc">     *  #include &lt;ti/sysbios/BIOS.h&gt;
</span>   421    <span class="xdoc">     *  #include &lt;ti/sysbios/knl/Task.h&gt;
</span>   422    <span class="xdoc">     *  ...
</span>   423    <span class="xdoc">     *  // Task create hook function that logs the task name.
</span>   424    <span class="xdoc">     *  // Notes: Task name is not trequired when creating a BIOS task. Please \
</span>   425    <span class="xdoc">     *  // make sure a name is provided in order for the host side analysis tool
</span>   426    <span class="xdoc">     *  // to work properly.
</span>   427    <span class="xdoc">     *  Void  tskCreateHook(Task_Handle hTask, Error_Block *eb) {
</span>   428    <span class="xdoc">     *          String name;
</span>   429    <span class="xdoc">     *          name = Task_Handle_name(hTask);
</span>   430    <span class="xdoc">     *          LogSnapshot_writeNameOfReference(hTask,"Task_create: name=%s",
</span>   431    <span class="xdoc">     *            name,strlen(name)+1);
</span>   432    <span class="xdoc">     *  }
</span>   433    <span class="xdoc">     *  <b>@p</b>
</span>   434    <span class="xdoc">     *  This event prints the Log call site (%$F) and a format string (%$S)
</span>   435    <span class="xdoc">     *  which describes what information the event is logging.
</span>   436    <span class="xdoc">     *  The following text will be displayed for the event:
</span>   437    <span class="xdoc">     *  <b>@p(code)</b>
</span>   438    <span class="xdoc">     *  nameOfReference at  [demo.c:line 1234] [refID=0x80002000,adrs=0x80001234,40,40] Task_create: name=10msThread.
</span>   439    <span class="xdoc">     *  <b>@param(refID)</b>        reference ID (e.g. task handle) that the name is
</span>   440    <span class="xdoc">     *                       associated with
</span>   441    <span class="xdoc">     *  <b>@param(pString)</b>      the start address of the string on the heap
</span>   442    <span class="xdoc">     *  <b>@param(lengthInMAUs)</b> the number of MAUs to log (e.g. strlen(pString))
</span>   443    <span class="xdoc">     *  <b>@param(fmt)</b>          a constant string that provides format specifiers
</span>   444    <span class="xdoc">     *                       describing the string
</span>   445    <span class="xdoc">     */</span>
   446        @Macro Void writeNameOfReference(UInt32 refID, IArg fmt, Ptr pString,
   447        UInt16 lengthInMAUs);
   448    
   449        <span class="xdoc">/*!
</span>   450    <span class="xdoc">     * ======== getSnapshotId ========
</span>   451    <span class="xdoc">     * returns a unique ID to use to group a set of snapshot event logs together
</span>   452    <span class="xdoc">     *
</span>   453    <span class="xdoc">     * Allows tooling to treat a set of consecutive event logs as a unit and
</span>   454    <span class="xdoc">     * display all of the relevent data together as a set
</span>   455    <span class="xdoc">     *  <b>@a(Example)</b>
</span>   456    <span class="xdoc">     *   The following C code shows how to log two snapshot events that capture
</span>   457    <span class="xdoc">     *   the target state of two different data structures, using a common unique
</span>   458    <span class="xdoc">     *   non-zero snapshot ID provided by the getSnapshotId to inform the host-side
</span>   459    <span class="xdoc">     *   tooling that the events represent the target state at the same point in time
</span>   460    <span class="xdoc">     *  <b>@p(code)</b>
</span>   461    <span class="xdoc">     *  #include &lt;ti/uia/runtime/LogSnapshot.h&gt;
</span>   462    <span class="xdoc">     *  ...
</span>   463    <span class="xdoc">     *  MyStruct1 myStruct1;
</span>   464    <span class="xdoc">     *  MyStruct2 myStruct2;
</span>   465    <span class="xdoc">     *  UInt32 snapshotId;
</span>   466    <span class="xdoc">     *  ...
</span>   467    <span class="xdoc">     *  snapshotId = LogSnapshot_getSnapshotId();
</span>   468    <span class="xdoc">     *  LogSnapshot_writeMemoryBlock(snapshotId,"myStruct1 ptr=0x%x, numBytes=%d",(UInt32)&amp;myStruct1,sizeof(MyStruct1));
</span>   469    <span class="xdoc">     *  LogSnapshot_writeMemoryBlock(snapshotId,"myStruct2 ptr=0x%x, numBytes=%d",(UInt32)&amp;myStruct2,sizeof(MyStruct2));
</span>   470    <span class="xdoc">     *  ...
</span>   471    <span class="xdoc">     *  <b>@p</b>
</span>   472    <span class="xdoc">     * <b>@a(return)</b> a unique non-zero snapshot ID to pass in as a parameter to the
</span>   473    <span class="xdoc">     *    LogSnapshot APIs
</span>   474    <span class="xdoc">     */</span>
   475        @DirectCall
   476        UInt32 getSnapshotId();
   477    
   478        <span class="xdoc">/*!
</span>   479    <span class="xdoc">     *  ======== doPrint ========
</span>   480    <span class="xdoc">     *  Render an event as text via `{<b>@link</b> System#printf System_printf}`
</span>   481    <span class="xdoc">     *
</span>   482    <span class="xdoc">     *  This method is not currently implemented.
</span>   483    <span class="xdoc">     *
</span>   484    <span class="xdoc">     *  <b>@param(evRec)</b>   a non`NULL` pointer to an initialized `
</span>   485    <span class="xdoc">     *     LogSnapshot_EventRec`structure to be formated via
</span>   486    <span class="xdoc">     *     {<b>@link</b> System#printf System_printf}`.
</span>   487    <span class="xdoc">     */</span>
   488        Void doPrint(EventRec *er);
   489    
   490        <span class="comment">/* @_nodoc
</span>   491    <span class="comment">     *  ======== idToInfo ========
</span>   492    <span class="comment">     *  Map event ID strings into a string of the form &lt;eventName&gt;::&lt;eventMsg&gt;
</span>   493    <span class="comment">     */</span>
   494        <span class=key>metaonly</span> <span class=key>config</span> String idToInfo[string] = [];
   495    
   496    }
</pre>
</body></html>
